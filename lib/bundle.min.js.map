{"version":3,"file":"bundle.min.js","sources":["../plugin/object.class.js","../plugin/index.js"],"sourcesContent":["export default class Cache {\n  constructor(params = {}) {\n    this.databaseName = params.databaseName || \"cache\";     // 数据库名称\n    this.tableName = params.databaseName || \"localStorage\"; // 表名\n    this.version = params.version || 1;                     // 版本号\n    this.memory = params.memory === false ? false : true;   // 是否启用内存接管\n    this.db = null;                                         // 数据库对象\n    this.source = {}                                        // 源数据=》内存\n    this.init();\n  }\n\n  // 源数据内存接管\n  setSource(key, value) {\n    if (this.source && this.memory) {\n      this.source[key] = value;\n    } else {\n      this.source = {}\n    }\n  }\n\n  // 初始化\n  async init() {\n    try {\n      this.db = await this.open();\n      this.memory && this.readAll();\n      console.log(`loaded cache，version ${this.version}`);\n    } catch (e) {\n      this.error(e);\n    }\n  }\n\n  // 创建数据库\n  create(db) {\n    db.createObjectStore(this.tableName, { keyPath: \"key\" });\n    console.log(`loaded cache create ${this.tableName}`);\n  }\n\n  // 打开数据库\n  open() {\n    return new Promise((resolve, reject) => {\n      if (this.db) {\n        resolve(this.db);\n      } else {\n        const { databaseName, version } = this;\n        let request = window.indexedDB.open(databaseName, version);\n        // 打开数据库失败\n        request.onerror = (e) => reject(e);\n        // 打开数据库成功\n        request.onsuccess = (e) => resolve(e.target.result);\n        // 数据库升级事件\n        request.onupgradeneeded = (e) => this.create(e.target.result);\n      }\n    });\n  }\n\n  // 异常\n  error(e) {\n    console.log(new Error(e));\n  }\n\n  // 设置数据\n  async set(key, value) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return this.update(key, value);\n      } else {\n        return this.add(key, value);\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncSet(key, value) {\n    const res = await this.set(key, value);\n    return res;\n  }\n\n  // 新增\n  async add(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").add({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  // 更新数据\n  async update(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").put({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n\n  // 返回数据\n  async get(key) {\n    this.db = await this.open();\n    const value = this.syncGet(key);\n    if (value) {\n      return Promise.resolve(value);\n    } else {\n      return new Promise((resolve, reject) => {\n        let request = this.handler(\"readonly\").get(key);\n        request.onsuccess = (e) => resolve(e.target.result);\n        request.onerror = (e) => reject(e);\n      });\n    }\n  }\n  syncGet(key) {\n    return this.source[key] || null;\n  }\n\n  // 删除数据\n  async del(key) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return new Promise((resolve, reject) => {\n          let request = this.handler(\"readwrite\").delete(key);\n          request.onsuccess = (e) => {\n            delete this.source[key];\n            resolve(e)\n          };\n          request.onerror = (e) => reject(e);\n        });\n      } else {\n        return Promise.resolve();\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncDel(key) {\n    const res = await this.del(key);\n    return res;\n  }\n\n  // 清空数据\n  clear() {\n    return new Promise((resolve, reject) => {\n      const { databaseName } = this;\n      let request = window.indexedDB.deleteDatabase(databaseName);\n      request.onsuccess = (e) => {\n        this.source = null;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  async syncClear() {\n    const res = await this.clear();\n    return res;\n  }\n\n  // 操作\n  handler(mode = \"readonly\") {\n    const { tableName } = this;\n    return this.db.transaction([tableName], mode).objectStore(tableName);\n  }\n\n  // 遍历数据\n  async readAll() {\n    this.db = await this.open();\n    let source = {};\n    return new Promise(resolve => {\n      let request = this.handler();\n      request.openCursor().onsuccess = (e) => {\n        const cursor = e.target.result;\n        if (cursor) {\n          source[cursor.key] = cursor.value.value\n          this.setSource(cursor.key, cursor.value.value);\n          cursor.continue();\n        } else {\n          console.log(\"数据遍历完毕\");\n          resolve(source);\n        }\n      }\n    })\n  }\n}\n","export { default as Cache} from \"./object.class\";\nimport Cache from \"./object.class\";\n\nexport const createCache = function(params = {}){\n  const cache = new Cache(params);\n  return cache;\n};\n\nexport const install = function(app, params = {}){\n  const cache = createCache(params);\n  app.prototype && (app.prototype.$cache = cache);\n  app.config && (app.config.globalProperties = cache);\n};\n"],"names":["Cache","constructor","params","databaseName","tableName","version","memory","db","source","init","setSource","key","value","open","readAll","console","log","e","error","create","createObjectStore","keyPath","Promise","resolve","reject","request","window","indexedDB","onerror","onsuccess","target","result","onupgradeneeded","Error","set","res","get","update","add","syncSet","handler","put","syncGet","del","delete","syncDel","clear","deleteDatabase","syncClear","mode","transaction","objectStore","openCursor","cursor","continue","createCache","cache","install","app","prototype","$cache","config","globalProperties"],"mappings":"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"}