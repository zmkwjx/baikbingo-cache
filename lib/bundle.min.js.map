{"version":3,"file":"bundle.min.js","sources":["../plugin/object.class.js","../plugin/index.js"],"sourcesContent":["export default class Cache {\n  databaseName = \"cache\"; // 数据库名称\n  tableName = \"localStorage\"; // 表名\n  version = 1; // 版本号\n\n  db = null; // 数据库对象\n  queue = null; // 队列\n  source = {} // 源数据=》内存\n\n  constructor(params = {}) {\n    params.databaseName && (this.databaseName = params.databaseName);\n    params.tableName && (this.tableName = params.tableName);\n    params.version && (this.version = params.version);\n    this.init();\n  }\n\n  // 初始化\n  async init() {\n    try {\n      this.db = await this.open();\n      this.readAll();\n      console.log(`loaded cache，version ${this.version}`);\n    } catch (e) {\n      this.error(e);\n    }\n  }\n\n  // 创建数据库\n  create(db) {\n    db.createObjectStore(this.tableName, { keyPath: \"key\" });\n    console.log(`loaded cache create ${this.tableName}`);\n  }\n\n  // 打开数据库\n  open() {\n    return new Promise((resolve, reject) => {\n      if (this.db) {\n        resolve(this.db);\n      } else {\n        const { databaseName, version } = this;\n        let request = window.indexedDB.open(databaseName, version);\n        // 打开数据库失败\n        request.onerror = (e) => reject(e);\n        // 打开数据库成功\n        request.onsuccess = (e) => resolve(e.target.result);\n        // 数据库升级事件\n        request.onupgradeneeded = (e) => this.create(e.target.result);\n      }\n    });\n  }\n\n  // 异常\n  error(e) {\n    console.log(new Error(e));\n  }\n\n  // 设置数据\n  async set(key, value) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return this.update(key, value);\n      } else {\n        return this.add(key, value);\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncSet(key, value) {\n    const res = await this.set(key, value);\n    return res;\n  }\n\n  // 新增\n  async add(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").add({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  // 更新数据\n  async update(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").put({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n\n  // 返回数据\n  async get(key) {\n    this.db = await this.open();\n    const value = this.syncGet(key);\n    if (value) {\n      return Promise.resolve(value);\n    } else {\n      return new Promise((resolve, reject) => {\n        let request = this.handler(\"readonly\").get(key);\n        request.onsuccess = (e) => resolve(e.target.result);\n        request.onerror = (e) => reject(e);\n      });\n    }\n  }\n  syncGet(key) {\n    return this.source[key] || null;\n  }\n\n  // 删除数据\n  async del(key) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return new Promise((resolve, reject) => {\n          let request = this.handler(\"readwrite\").delete(key);\n          request.onsuccess = (e) => {\n            delete this.source[key];\n            resolve(e)\n          };\n          request.onerror = (e) => reject(e);\n        });\n      } else {\n        return Promise.resolve();\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncDel(key) {\n    const res = await this.del(key);\n    return res;\n  }\n\n  // 清空数据\n  clear() {\n    return new Promise((resolve, reject) => {\n      const { databaseName } = this;\n      let request = window.indexedDB.deleteDatabase(databaseName);\n      request.onsuccess = (e) => {\n        this.source = null;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  async syncClear() {\n    const res = await this.clear();\n    return res;\n  }\n\n  // 操作\n  handler(mode = \"readonly\") {\n    const { tableName } = this;\n    return this.db.transaction([tableName], mode).objectStore(tableName);\n  }\n\n  // 遍历数据\n  async readAll() {\n    this.db = await this.open();\n    return new Promise(resolve => {\n      let request = this.handler();\n      request.openCursor().onsuccess = (e) => {\n        const cursor = e.target.result;\n        if (cursor) {\n          this.source[cursor.key] = cursor.value.value;\n          cursor.continue();\n        } else {\n          console.log(\"数据遍历完毕\");\n          resolve();\n        }\n      }\n    })\n  }\n}\n","export { default as Cache} from \"./object.class\";\nimport Cache from \"./object.class\";\n\nexport const createCache = function(params = {}){\n  const cache = new Cache(params);\n  return cache;\n};\n\nexport const install = function(app, params = {}){\n  const cache = createCache(params);\n  app.prototype && (app.prototype.$cache = cache);\n  app.config && (app.config.globalProperties = cache);\n};\n"],"names":[],"mappings":"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"}