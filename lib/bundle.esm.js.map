{"version":3,"file":"bundle.esm.js","sources":["../plugin/object.class.js","../plugin/index.js"],"sourcesContent":["export default class Cache {\n  databaseName = \"cache\"; // 数据库名称\n  tableName = \"localStorage\"; // 表名\n  version = 1; // 版本号\n\n  db = null; // 数据库对象\n  queue = null; // 队列\n  source = {} // 源数据=》内存\n\n  constructor(params = {}) {\n    params.databaseName && (this.databaseName = params.databaseName);\n    params.tableName && (this.tableName = params.tableName);\n    params.version && (this.version = params.version);\n    this.init();\n  }\n\n  // 初始化\n  async init() {\n    try {\n      this.db = await this.open();\n      this.readAll();\n      console.log(`loaded cache，version ${this.version}`);\n    } catch (e) {\n      this.error(e);\n    }\n  }\n\n  // 创建数据库\n  create(db) {\n    db.createObjectStore(this.tableName, { keyPath: \"key\" });\n    console.log(`loaded cache create ${this.tableName}`);\n  }\n\n  // 打开数据库\n  open() {\n    return new Promise((resolve, reject) => {\n      if (this.db) {\n        resolve(this.db);\n      } else {\n        const { databaseName, version } = this;\n        let request = window.indexedDB.open(databaseName, version);\n        // 打开数据库失败\n        request.onerror = (e) => reject(e);\n        // 打开数据库成功\n        request.onsuccess = (e) => resolve(e.target.result);\n        // 数据库升级事件\n        request.onupgradeneeded = (e) => this.create(e.target.result);\n      }\n    });\n  }\n\n  // 异常\n  error(e) {\n    console.log(new Error(e));\n  }\n\n  // 设置数据\n  async set(key, value) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return this.update(key, value);\n      } else {\n        return this.add(key, value);\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncSet(key, value) {\n    const res = await this.set(key, value);\n    return res;\n  }\n\n  // 新增\n  async add(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").add({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  // 更新数据\n  async update(key, value) {\n    this.db = await this.open();\n    return new Promise((resolve, reject) => {\n      let request = this.handler(\"readwrite\").put({ key, value });\n      request.onsuccess = (e) => {\n        this.source[key] = value;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n\n  // 返回数据\n  async get(key) {\n    this.db = await this.open();\n    const value = this.syncGet(key);\n    if (value) {\n      return Promise.resolve(value);\n    } else {\n      return new Promise((resolve, reject) => {\n        let request = this.handler(\"readonly\").get(key);\n        request.onsuccess = (e) => resolve(e.target.result);\n        request.onerror = (e) => reject(e);\n      });\n    }\n  }\n  syncGet(key) {\n    return this.source[key] || null;\n  }\n\n  // 删除数据\n  async del(key) {\n    try {\n      let res = await this.get(key);\n      if (res) {\n        return new Promise((resolve, reject) => {\n          let request = this.handler(\"readwrite\").delete(key);\n          request.onsuccess = (e) => {\n            delete this.source[key];\n            resolve(e)\n          };\n          request.onerror = (e) => reject(e);\n        });\n      } else {\n        return Promise.resolve();\n      }\n    } catch (e) {\n      this.error(e);\n      return Promise.reject(e);\n    }\n  }\n  async syncDel(key) {\n    const res = await this.del(key);\n    return res;\n  }\n\n  // 清空数据\n  clear() {\n    return new Promise((resolve, reject) => {\n      const { databaseName } = this;\n      let request = window.indexedDB.deleteDatabase(databaseName);\n      request.onsuccess = (e) => {\n        this.source = null;\n        resolve(e)\n      };\n      request.onerror = (e) => reject(e);\n    });\n  }\n  async syncClear() {\n    const res = await this.clear();\n    return res;\n  }\n\n  // 操作\n  handler(mode = \"readonly\") {\n    const { tableName } = this;\n    return this.db.transaction([tableName], mode).objectStore(tableName);\n  }\n\n  // 遍历数据\n  async readAll() {\n    this.db = await this.open();\n    return new Promise(resolve => {\n      let request = this.handler();\n      request.openCursor().onsuccess = (e) => {\n        const cursor = e.target.result;\n        if (cursor) {\n          this.source[cursor.key] = cursor.value.value;\n          cursor.continue();\n        } else {\n          console.log(\"数据遍历完毕\");\n          resolve();\n        }\n      }\n    })\n  }\n}\n","export { default as Cache} from \"./object.class\";\nimport Cache from \"./object.class\";\n\nexport const createCache = function(params = {}){\n  const cache = new Cache(params);\n  return cache;\n};\n\nexport const install = function(app, params = {}){\n  const cache = createCache(params);\n  app.prototype && (app.prototype.$cache = cache);\n  app.config && (app.config.globalProperties = cache);\n};\n"],"names":[],"mappings":"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"}